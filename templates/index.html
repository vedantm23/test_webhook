<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Activity Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            font-family: 'Roboto Mono', monospace;
            padding: 2rem 1rem;
        }

        .container-custom {
            max-width: 960px;
            margin: auto;
            padding: 2rem;
            background-color: #161b22;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #58a6ff;
        }

        .header p {
            color: #8b949e;
        }

        .status-bar {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background-color: #21262d;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #2ea043;
        }

        .dot {
            width: 10px;
            height: 10px;
            background-color: #2ea043;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .events {
            margin-top: 2rem;
            max-height: 500px;
            overflow-y: auto;
        }

        .event {
            padding: 1rem;
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-left: 5px solid #58a6ff;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .event.push { border-left-color: #58a6ff; }
        .event.pull_request { border-left-color: #f0b400; }
        .event.merge { border-left-color: #2ea043; }

        .event-type {
            font-size: 0.75rem;
            font-weight: 600;
            color: #c9d1d9;
            background-color: #30363d;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            text-transform: uppercase;
        }

        .repository {
            font-size: 0.85rem;
            color: #8b949e;
        }

        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top: 4px solid #58a6ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            color: #f85149;
            background-color: #2d1214;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container-custom">
        <div class="header text-center mb-4">
            <h1>GitHub Activity Tracker</h1>
            <p class="mb-0">Live updates every 15 seconds</p>
        </div>

        <div class="status-bar mb-4">
            <div class="dot"></div>
            <div>Monitoring active</div>
        </div>

        <div id="error-container"></div>

        <div class="events" id="events-container">
            <div class="text-center">
                <div class="loading-spinner"></div>
                <p>Loading recent activity...</p>
            </div>
        </div>
    </div>

    <script>
        let lastEventIds = new Set();
        let isInitialLoad = true;

        async function fetchEvents() {
            try {
                const response = await fetch('/api/events');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const events = await response.json();
                displayEvents(events);
                clearError();
            } catch (error) {
                showError('Error fetching events. Please check your connection.');
            }
        }

        function displayEvents(events) {
            const container = document.getElementById('events-container');

            if (events.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted">
                        <p>No recent GitHub activity</p>
                    </div>
                `;
                return;
            }

            const newEvents = events.filter(event => !lastEventIds.has(event.id));

            if (isInitialLoad || newEvents.length > 0) {
                let html = '';
                events.forEach(event => {
                    html += `
                        <div class="event ${event.event_type}" data-id="${event.id}">
                            <div class="fw-bold">${event.message}</div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <span class="event-type ${event.event_type}">${event.event_type.replace('_', ' ')}</span>
                                <span class="repository">${event.repository}</span>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
                lastEventIds = new Set(events.map(e => e.id));
                isInitialLoad = false;
            }
        }

        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
        }

        function clearError() {
            document.getElementById('error-container').innerHTML = '';
        }

        fetchEvents();
        setInterval(fetchEvents, 15000);

        let updateIndicator = null;

        function showUpdateIndicator() {
            if (updateIndicator) clearTimeout(updateIndicator);
            document.querySelector('.dot').style.backgroundColor = '#f0b400';
            updateIndicator = setTimeout(() => {
                document.querySelector('.dot').style.backgroundColor = '#2ea043';
            }, 1000);
        }

        const originalFetch = fetchEvents;
        fetchEvents = function () {
            showUpdateIndicator();
            return originalFetch();
        };
    </script>
</body>

</html>
